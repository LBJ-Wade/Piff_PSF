
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Models &#8212; Piff 0.4 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interpolation Schemes" href="interp.html" />
    <link rel="prev" title="Reading in Files" href="input.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="interp.html" title="Interpolation Schemes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="input.html" title="Reading in Files"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Piff 0.4 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="models">
<h1>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h1>
<p>Models govern what functional form to use for the PSF at a single location.</p>
<div class="section" id="the-model-base-class">
<h2>The Model base class<a class="headerlink" href="#the-model-base-class" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.Model">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Model</code><a class="reference internal" href="_modules/piff/model.html#Model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for modeling a single PSF (i.e. no interpolation yet)</p>
<p>This is essentially an abstract base class intended to define the methods that should be
implemented by any derived class.</p>
<dl class="py method">
<dt id="piff.Model.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.draw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw the model on the given image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance with the fitted parameters to use for drawing and a
data field that acts as a template image for the drawn model.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance with the data field having an image of the drawn model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the Model to the star’s data to yield iterative improvement on
its PSF parameters, their uncertainties, and flux (and center, if free).
The returned star.fit.alpha will be inverse covariance of solution if
it is estimated, else is None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>star</strong> – A Star instance</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New Star instance with updated fit information</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.initialize">
<code class="sig-name descname">initialize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.initialize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a star to work with the current model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance with the raw data.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Star instance with the appropriate initial fit values</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.normalize">
<code class="sig-name descname">normalize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.normalize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.normalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure star.fit.params are normalized properly.</p>
<p>Note: This modifies the input star in place.</p>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.parseKwargs">
<em class="property">classmethod </em><code class="sig-name descname">parseKwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_model</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.parseKwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.parseKwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the model field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<p>The base class implementation just returns the kwargs as they are, but derived classes
might want to override this if they need to do something more sophisticated with them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_model</strong> – The model field of the configuration dict, config[‘model’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.process">
<em class="property">classmethod </em><code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_model</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the model field of the config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_model</strong> – The configuration dict for the model field.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a Model instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.read">
<em class="property">classmethod </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a Model from a FITS file.</p>
<p>Note: the returned Model will not have its parameters set.  This just initializes a fresh
model that can be used to interpret interpolated vectors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension with the model information.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a model built with a information in the FITS file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Model.write">
<code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/model.html#Model.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Model.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a Model to a FITS file.</p>
<p>Note: this only writes the initialization kwargs to the fits extension, not the parameters.</p>
<p>The base class implemenation works if the class has a self.kwargs attribute and these
are all simple values (str, float, or int)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to write the model information.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="gsobjectmodel">
<h2>GSObjectModel<a class="headerlink" href="#gsobjectmodel" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.GSObjectModel">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">GSObjectModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">gsobj</span></em>, <em class="sig-param"><span class="n">fastfit</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">centered</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">include_pixel</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Model that takes a fiducial GalSim.GSObject and dilates, shifts, and shears it to get a
good match to stars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gsobj</strong> – GSObject to use as fiducial profile.</p></li>
<li><p><strong>fastfit</strong> – Use HSM moments for fitting.  Approximate, but fast.  [default: False]</p></li>
<li><p><strong>centered</strong> – If True, PSF model centroid is forced to be (0,0), and the
PSF fitting will marginalize over stellar position.  If False, stellar
position is fixed at input value and the fitted PSF may be off-center.
[default: True]</p></li>
<li><p><strong>include_pixel</strong> – Include integration over pixel when drawing?  [default: True]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="piff.GSObjectModel.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">fastfit</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the image either using HSM or least-squares minimization.</p>
<p>If <cite>fastfit</cite> is True, then the galsim.hsm module will be used to estimate the transformation
parameters that take the fiducial moments into the data moments.  If <cite>fastfit</cite> is False,
then the Levenberg-Marquardt minimization algorithm will be used instead.  The latter should
generally be more accurate, but slower due to the need to iteratively propose model
improvements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star to fit.</p></li>
<li><p><strong>fastfit</strong> – Use fast HSM moments to fit? [default: None, which means use fitting mode
specified in the constructor.]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star with the fitted parameters in star.fit</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.GSObjectModel.getProfile">
<code class="sig-name descname">getProfile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.getProfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.getProfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a version of the model as a GalSim GSObject</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> – A numpy array with either  [ size, g1, g2 ]
or  [ cenu, cenv, size, g1, g2 ]
depending on if the center of the model is being forced to (0.0, 0.0)
or not.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a galsim.GSObject instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.GSObjectModel.initialize">
<code class="sig-name descname">initialize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.initialize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the given star’s fit parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – The Star to initialize.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new initialized Star.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.GSObjectModel.least_squares_fit">
<code class="sig-name descname">least_squares_fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.least_squares_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.least_squares_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit parameters of the given star using least-squares minimization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star to fit.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(flux, dx, dy, scale, g1, g2, flag)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.GSObjectModel.moment_fit">
<code class="sig-name descname">moment_fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.moment_fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.moment_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate transformations needed to bring self.gsobj towards given star.</p>
</dd></dl>

<dl class="py method">
<dt id="piff.GSObjectModel.reflux">
<code class="sig-name descname">reflux</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">fit_center</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#GSObjectModel.reflux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.GSObjectModel.reflux" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the Model to the star’s data, varying only the flux (and
center, if it is free).  Flux and center are updated in the Star’s
attributes.  This is a single-step solution if only solving for flux,
otherwise an iterative operation.  DOF in the result assume
only flux (&amp; center) are free parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance</p></li>
<li><p><strong>fit_center</strong> – If False, disable any motion of center</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New Star instance, with updated flux, center, chisq, dof</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="piff.Gaussian">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Gaussian</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fastfit</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">centered</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">include_pixel</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#Gaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Gaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>Model PSFs as elliptical Gaussians.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fastfit</strong> – Use HSM moments for fitting.  Approximate, but fast.  [default: False]</p></li>
<li><p><strong>centered</strong> – If True, PSF model centroid is forced to be (0,0), and the
PSF fitting will marginalize over stellar position.  If False, stellar
position is fixed at input value and the fitted PSF may be off-center.
[default: True]</p></li>
<li><p><strong>include_pixel</strong> – Include integration over pixel when drawing?  [default: True]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="piff.Kolmogorov">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Kolmogorov</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fastfit</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">centered</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">include_pixel</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#Kolmogorov"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Kolmogorov" title="Permalink to this definition">¶</a></dt>
<dd><p>Model PSFs as elliptical Kolmogorovs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fastfit</strong> – Use HSM moments for fitting.  Approximate, but fast.  [default: False]</p></li>
<li><p><strong>centered</strong> – If True, PSF model centroid is forced to be (0,0), and the
PSF fitting will marginalize over stellar position.  If False, stellar
position is fixed at input value and the fitted PSF may be off-center.
[default: True]</p></li>
<li><p><strong>include_pixel</strong> – Include integration over pixel when drawing?  [default: True]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="piff.Moffat">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Moffat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">beta</span></em>, <em class="sig-param"><span class="n">trunc</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">fastfit</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">centered</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">include_pixel</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/gsobject_model.html#Moffat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Moffat" title="Permalink to this definition">¶</a></dt>
<dd><p>Model PSFs as elliptical Moffats.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>beta</strong> – Moffat shape parameter.</p></li>
<li><p><strong>trunc</strong> – Optional truncation radius at which profile drops to zero.  Measured in half
light radii.  [default: 0, indicating no truncation]</p></li>
<li><p><strong>fastfit</strong> – Use HSM moments for fitting.  Approximate, but fast.  [default: False]</p></li>
<li><p><strong>centered</strong> – If True, PSF model centroid is forced to be (0,0), and the
PSF fitting will marginalize over stellar position.  If False, stellar
position is fixed at input value and the fitted PSF may be off-center.
[default: True]</p></li>
<li><p><strong>include_pixel</strong> – Include integration over pixel when drawing?  [default: True]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="pixelgrid">
<h2>PixelGrid<a class="headerlink" href="#pixelgrid" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.PixelGrid">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">PixelGrid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">scale</span></em>, <em class="sig-param"><span class="n">size</span></em>, <em class="sig-param"><span class="n">interp</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">centered</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">start_sigma</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">degenerate</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="piff.PixelGrid.chisq">
<code class="sig-name descname">chisq</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.chisq"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.chisq" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate dependence of chi^2 = -2 log L(D|p) on PSF parameters for single star.
as a quadratic form chi^2 = dp^T AT A dp - 2 bT A dp + chisq,
where dp is the <em>shift</em> from current parameter values.  Returned Star
instance has the resultant A, b, chisq, flux, center) attributes,
but params vector has not have been updated yet (could be degenerate).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance with updated StarFit</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the Model to the star’s data to yield iterative improvement on
its PSF parameters, their uncertainties, and flux (and center, if free).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance with updated fit information</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.getProfile">
<code class="sig-name descname">getProfile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.getProfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.getProfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a version of the model as a GalSim GSObject</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> – The fit parameters for a given star.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a galsim.GSObject instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.initialize">
<code class="sig-name descname">initialize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.initialize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.initialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a star to work with the current model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance with the raw data.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a star instance with the appropriate initial fit values</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.interp_calculate">
<code class="sig-name descname">interp_calculate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">u</span></em>, <em class="sig-param"><span class="n">v</span></em>, <em class="sig-param"><span class="n">derivs</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.interp_calculate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.interp_calculate" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate interpolation coefficient for vector of target points</p>
<p>Outputs will be 3 matrices, each of dimensions (nin, nkernel) where nin is
number of input coordinates and nkernel is number of points in kernel footprint.
The coeff matrix gives interpolation coefficients, then the y and x integer matrices
give the grid point to which each coefficient is applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>u</strong> – 1d array of target u coordinates</p></li>
<li><p><strong>v</strong> – 1d array of target v coordinates</p></li>
<li><p><strong>derivs</strong> – whether to also return derivatives (default: False)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>coeff, x, y[, dcdu, dcdv]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.normalize">
<code class="sig-name descname">normalize</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.normalize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.normalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure star.fit.params are normalized properly.</p>
<p>Note: This modifies the input star in place.</p>
</dd></dl>

<dl class="py method">
<dt id="piff.PixelGrid.reflux">
<code class="sig-name descname">reflux</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">fit_center</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/pixelgrid.html#PixelGrid.reflux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PixelGrid.reflux" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit the Model to the star’s data, varying only the flux (and
center, if it is free).  Flux and center are updated in the Star’s
attributes.  DOF in the result assume only flux (&amp; center) are free parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – A Star instance</p></li>
<li><p><strong>fit_center</strong> – If False, disable any motion of center</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance, with updated flux, center, chisq, dof</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="optical">
<h2>Optical<a class="headerlink" href="#optical" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.Optical">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Optical</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">template</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/optical_model.html#Optical"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Optical" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="piff.Optical.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/optical_model.html#Optical.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Optical.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Warning: This method just updates the fit with the chisq and dof!</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>star</strong> – A Star instance</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star with the fitted parameters in star.fit</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Optical.getProfile">
<code class="sig-name descname">getProfile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/optical_model.html#Optical.getProfile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Optical.getProfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a version of the model as a GalSim GSObject</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> – A np array with [z4, z5, z6…z11]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a galsim.GSObject instance</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Models</a><ul>
<li><a class="reference internal" href="#the-model-base-class">The Model base class</a></li>
<li><a class="reference internal" href="#gsobjectmodel">GSObjectModel</a></li>
<li><a class="reference internal" href="#pixelgrid">PixelGrid</a></li>
<li><a class="reference internal" href="#optical">Optical</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="input.html"
                        title="previous chapter">Reading in Files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interp.html"
                        title="next chapter">Interpolation Schemes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/model.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="interp.html" title="Interpolation Schemes"
             >next</a> |</li>
        <li class="right" >
          <a href="input.html" title="Reading in Files"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Piff 0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.
    </div>
  </body>
</html>