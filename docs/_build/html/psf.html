
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>PSF &#8212; Piff 0.4 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stats" href="stats.html" />
    <link rel="prev" title="Writing the output file" href="output.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="stats.html" title="Stats"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="output.html" title="Writing the output file"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Piff 0.4 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="psf">
<h1>PSF<a class="headerlink" href="#psf" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="piff.PSF">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">PSF</code><a class="reference internal" href="_modules/piff/psf.html#PSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for describing a PSF model across a field of view.</p>
<p>The usual way to create a PSF is through one of the two factory functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">PSF</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">PSF</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
</pre></div>
</div>
<p>The first is used to build a PSF model from the data according to a config dict.
The second is used to read in a PSF model from disk.</p>
<dl class="py method">
<dt id="piff.PSF.draw">
<code class="sig-name descname">draw</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">chipnum</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">flux</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">offset</span><span class="o">=</span><span class="default_value">0, 0</span></em>, <em class="sig-param"><span class="n">stamp_size</span><span class="o">=</span><span class="default_value">48</span></em>, <em class="sig-param"><span class="n">image</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.draw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.draw" title="Permalink to this definition">¶</a></dt>
<dd><p>Draws an image of the PSF at a given location.</p>
<p>The normal usage would be to specify (chipnum, x, y), in which case Piff will use the
stored wcs information for that chip to interpolate to the given position and draw
an image of the PSF:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">,</span> <span class="n">stamp_size</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
</pre></div>
</div>
<p>However, if the PSF interpolation used extra properties for the interpolation
(cf. psf.extra_interp_properties), you need to provide them as additional kwargs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">psf</span><span class="o">.</span><span class="n">extra_interp_properties</span><span class="p">)</span>
<span class="go">(&#39;ri_color&#39;,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chipnum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">103.3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">592.0</span><span class="p">,</span> <span class="n">ri_color</span><span class="o">=</span><span class="mf">0.23</span><span class="p">,</span> <span class="n">stamp_size</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
</pre></div>
</div>
<p>Normally, the image is constructed automatically based on stamp_size, in which case
the WCS will be taken to be the local Jacobian at this location on the original image.
However, if you provide your own image using the :image: argument, then whatever WCS
is present in that image will be respected.  E.g. if you want an image of the PSF in
sky coordinates rather than image coordinates, you can provide an image with just a
pixel scale for the WCS.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – The image x position.</p></li>
<li><p><strong>y</strong> – The image y position.</p></li>
<li><p><strong>chipnum</strong> – Which chip to use for WCS information. [default: 0, which is
appropriate if only using a single chip]</p></li>
<li><p><strong>flux</strong> – Flux of PSF to be drawn [default: 1.0]</p></li>
<li><p><strong>offset</strong> – (dx,dy) tuple giving offset of stellar center relative
to star.data.image_pos [default: (0,0)]</p></li>
<li><p><strong>stamp_size</strong> – The size of the image to construct if no image is provided.
[default: 48]</p></li>
<li><p><strong>image</strong> – An existing image on which to draw, if desired. [default: None]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
<li><p><strong>**kwargs</strong> – Any additional properties required for the interpolation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A GalSim Image of the PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.drawStarList">
<code class="sig-name descname">drawStarList</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.drawStarList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.drawStarList" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate PSF images for given stars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – List of Star instances holding information needed
for interpolation as well as an image/WCS into
which PSF will be rendered.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of Star instances with its image filled with
rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.parseKwargs">
<em class="property">classmethod </em><code class="sig-name descname">parseKwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_psf</span></em>, <em class="sig-param"><span class="n">logger</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.parseKwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.parseKwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<p>The base class implementation just returns the kwargs as they are, but derived classes
might want to override this if they need to do something more sophisticated with them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.process">
<em class="property">classmethod </em><code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_psf</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the config dict and return a PSF instance.</p>
<p>As the PSF class is an abstract base class, the returned type will in fact be some
subclass of PSF according to the contents of the config dict.</p>
<p>The provided config dict is typically the ‘psf’ field in the base config dict in
a YAML file, although for compound PSF types, it may be the field for just one of
several components.</p>
<p>This function merely creates a “blank” PSF object.  It does not actually do any
part of the solution yet.  Typically this will be followed by fit:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">PSF</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stars</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="n">pointing</span> <span class="o">=</span> <span class="n">piff</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">stars</span><span class="p">,</span> <span class="n">wcs</span><span class="p">,</span> <span class="n">pointing</span><span class="p">)</span>
</pre></div>
</div>
<p>at which point, the <code class="docutils literal notranslate"><span class="pre">psf</span></code> instance would have a solution to the PSF model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – A dict specifying what type of PSF to build along with the
appropriate kwargs for building it.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a PSF instance of the appropriate type.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.read">
<em class="property">classmethod </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_name</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a PSF object from a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> – The name of the file to read.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a PSF instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.readWCS">
<em class="property">classmethod </em><code class="sig-name descname">readWCS</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em>, <em class="sig-param"><span class="n">logger</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.readWCS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.readWCS" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the WCS information from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>wcs, pointing where wcs is a dict of galsim.BaseWCS instances and
pointing is a galsim.CelestialCoord instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.write">
<code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_name</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a PSF object to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_name</strong> – The name of the file to write to.</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.PSF.writeWCS">
<code class="sig-name descname">writeWCS</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em>, <em class="sig-param"><span class="n">logger</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/psf.html#PSF.writeWCS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.PSF.writeWCS" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the WCS information to a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to write to</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="section" id="simplepsf">
<h2>SimplePSF<a class="headerlink" href="#simplepsf" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.SimplePSF">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">SimplePSF</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">interp</span></em>, <em class="sig-param"><span class="n">outliers</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">extra_interp_properties</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">chisq_thresh</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">max_iter</span><span class="o">=</span><span class="default_value">30</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SimplePSF" title="Permalink to this definition">¶</a></dt>
<dd><p>A PSF class that uses a single model and interpolator.</p>
<p>A SimplePSF is built from a Model and an Interp object.
The model defines the functional form of the surface brightness profile, and the
interpolator defines how the parameters of the model vary across the field of view.</p>
<dl class="py method">
<dt id="piff.SimplePSF.drawStar">
<code class="sig-name descname">drawStar</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.drawStar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SimplePSF.drawStar" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate PSF image for a given star.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – Star instance holding information needed for interpolation as
well as an image/WCS into which PSF will be rendered.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Star instance with its image filled with rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.SimplePSF.drawStarList">
<code class="sig-name descname">drawStarList</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.drawStarList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SimplePSF.drawStarList" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate PSF images for given stars. Takes advantage of
interpolateList for significant speedup with some interpolators.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – List of Star instances holding information needed
for interpolation as well as an image/WCS into
which PSF will be rendered.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of Star instances with its image filled with
rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.SimplePSF.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">wcs</span></em>, <em class="sig-param"><span class="n">pointing</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SimplePSF.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit interpolated PSF model to star data using standard sequence of operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>wcs</strong> – A dict of WCS solutions indexed by chipnum.</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord object giving the telescope pointing.
[Note: pointing should be None if the WCS is not a CelestialWCS]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.SimplePSF.parseKwargs">
<em class="property">classmethod </em><code class="sig-name descname">parseKwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_psf</span></em>, <em class="sig-param"><span class="n">logger</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/simplepsf.html#SimplePSF.parseKwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SimplePSF.parseKwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="singlechippsf">
<h2>SingleChipPSF<a class="headerlink" href="#singlechippsf" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="piff.SingleChipPSF">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">SingleChipPSF</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">single_psf</span></em>, <em class="sig-param"><span class="n">nproc</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">extra_interp_properties</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SingleChipPSF" title="Permalink to this definition">¶</a></dt>
<dd><p>A PSF class that uses a separate PSF solution for each chip</p>
<dl class="py method">
<dt id="piff.SingleChipPSF.drawStar">
<code class="sig-name descname">drawStar</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">star</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.drawStar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SingleChipPSF.drawStar" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate PSF image for a given star.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>star</strong> – Star instance holding information needed for interpolation as
well as an image/WCS into which PSF will be rendered.</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Star instance with its image filled with rendered PSF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.SingleChipPSF.fit">
<code class="sig-name descname">fit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">wcs</span></em>, <em class="sig-param"><span class="n">pointing</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.fit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SingleChipPSF.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit interpolated PSF model to star data using standard sequence of operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>wcs</strong> – A dict of WCS solutions indexed by chipnum.</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord object giving the telescope pointing.
[Note: pointing should be None if the WCS is not a CelestialWCS]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.SingleChipPSF.parseKwargs">
<em class="property">classmethod </em><code class="sig-name descname">parseKwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">config_psf</span></em>, <em class="sig-param"><span class="n">logger</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/singlechip.html#SingleChipPSF.parseKwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.SingleChipPSF.parseKwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse the psf field of a configuration dict and return the kwargs to use for
initializing an instance of the class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_psf</strong> – The psf field of the configuration dict, config[‘psf’]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a kwargs dict to pass to the initializer</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="stars">
<h1>Stars<a class="headerlink" href="#stars" title="Permalink to this headline">¶</a></h1>
<dl class="py class">
<dt id="piff.Star">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">Star</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">fit</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star" title="Permalink to this definition">¶</a></dt>
<dd><p>Information about a “star”, which may be either a real star or an interpolated star
at some target location.</p>
<p>The Star object is the fundamental way that Piff keeps track of information connected to
a particular observation location.  This includes both the input data (postage stamp image,
position on the detector, position in the field of view, weight image, etc.) and derived
information connected to whatever Model is being used</p>
<p>Stars are not normally constructed directly by the user.  They are built by various
Piff functions such as:</p>
<blockquote>
<div><p>stars = input_handler.makeStars(logger)
stars, wcs = piff.Input.process(config[‘input’])
target_star = piff.Star.makeTarget(x=x, y=y, wcs=wcs, …)</p>
</div></blockquote>
<p>However, a star can be constructed directly from a StarData instance and a StarFit instance.
The former keeps track of the data about the star (either as observed or the model at a
location) and the latter keeps track of fitted parameters related to fitting the data to
a model.</p>
<blockquote>
<div><p>star = piff.Star(star_data, star_fit)</p>
</div></blockquote>
<p>Stars have an immutable design, so any functions that change either the data or the fitted
parameters return a new object and  don’t change the original.  e.g.</p>
<blockquote>
<div><p>star = psf.drawStar(star)
star = star.reflux()
star = star.addPoisson(gain=gain)</p>
</div></blockquote>
<p>Stars have the following attributes:</p>
<blockquote>
<div><p>star.data       The component StarData object
star.fit        The component StarFit object</p>
</div></blockquote>
<p>and the following read-only properties:</p>
<blockquote>
<div><p>star.image      The image of the star
star.weight     The weight map connected to the image data
star.image_pos  The position of the star in image coordinates, aka (x,y)
star.field_pos  The position of the star in field coordinates, aka (u,v)
star.x          The x position of the star in image coordinates
star.y          The y position of the star in image coordinates
star.u          The u position of the star in field coordinates
star.v          The v position of the star in field coordinates
star.chipnum    The chip number where this star was observed (or would be observed)
star.flux       The flux of the object
star.center     The nominal center of the object (not necessarily the centroid)</p>
</div></blockquote>
<dl class="py method">
<dt id="piff.Star.addPoisson">
<code class="sig-name descname">addPoisson</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">signal</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gain</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.addPoisson"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.addPoisson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new Star with the weight values altered to reflect
Poisson shot noise from a signal source, e.g. when the weight
only contains variance from background and read noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal</strong> – The signal (as a Star instance) from which the Poisson variance is
extracted.  If None, the data image is used.  All signals are
clipped from below at zero.</p></li>
<li><p><strong>gain</strong> – The gain, in e per ADU, assumed in calculating new weights.  If None
is given, then the ‘gain’ property is used, else defaults to not
adding any variance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new Star instance with updated weight array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.center_to_offset">
<code class="sig-name descname">center_to_offset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">center</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.center_to_offset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.center_to_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility routine to convert from a center position in focal plane coordinates to the
corresponding offset in image coordinates on the postage stamp image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>center</strong> – A tuple (u,v) in focal plane coordinates</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The corresponding (dx,dy) in image coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.load_images">
<em class="property">static </em><code class="sig-name descname">load_images</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">file_name</span></em>, <em class="sig-param"><span class="n">pointing</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">image_hdu</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">weight_hdu</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">badpix_hdu</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sky</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.load_images"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.load_images" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the image data into a list of Stars.</p>
<p>We don’t store the image data for Stars when we write them to a file, since that
would take up a lot of space and is usually not desired.  However, we do store the
bounds in the original image where the star was cutout, so if you want to load back in
the original data from the image file, you can do so with this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of Star instances.</p></li>
<li><p><strong>file_name</strong> – The file with the image data for these stars.</p></li>
<li><p><strong>pointing</strong> – The pointing direction to use. [default: None]</p></li>
<li><p><strong>image_hdu</strong> – The hdu to use for the main image. [default: None, which means
either 0 or 1 as appropriate according to the compression.]</p></li>
<li><p><strong>weight_hdu</strong> – The hdu to use for the weight image. [default: None]</p></li>
<li><p><strong>badpix_hdu</strong> – The hdu to use for the bad pixel mask. [default: None]</p></li>
<li><p><strong>sky</strong> – Optional sky image or float value to subtract from the main
image. [default: None]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new list of Stars with the images information loaded.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.makeTarget">
<em class="property">classmethod </em><code class="sig-name descname">makeTarget</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">y</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">u</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">v</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">properties</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="n">wcs</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">scale</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">stamp_size</span><span class="o">=</span><span class="default_value">48</span></em>, <em class="sig-param"><span class="n">image</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">weight</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pointing</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">flux</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.makeTarget"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.makeTarget" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a target Star object with the requested properties.</p>
<p>The image will be blank (all zeros), and the properties field will match the given
input properties.</p>
<p>The input properties must have either ‘x’ and ‘y’ or ‘u’ and ‘v’.  The other pair will
be calculated from the wcs if one is provided, or you may pass in both sets of coordinates
and leave out the wcs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – The image x position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>y</strong> – The image y position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>u</strong> – The image u position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>v</strong> – The image v position. [optional, see above; may also be given as part
of the :properties: dict.]</p></li>
<li><p><strong>properties</strong> – The requested properties for the target star, including any other
requested properties besides x,y,u,v.  You may also provide x,y,u,v
in this dict rather than explicitly as kwargs. [default: None]</p></li>
<li><p><strong>wcs</strong> – The requested WCS.  [optional]</p></li>
<li><p><strong>scale</strong> – If wcs is None, you may instead provide a pixel scale. [default: None]</p></li>
<li><p><strong>stamp_size</strong> – The size in each direction of the (blank) image. [default: 48]</p></li>
<li><p><strong>image</strong> – An existing image to use instead of making a new one, if desired.
[default: None; this overrides stamp_size]</p></li>
<li><p><strong>weight</strong> – An existing image to use for the weight. [default: None]</p></li>
<li><p><strong>pointing</strong> – The pointing direction to use. [default: None]</p></li>
<li><p><strong>flux</strong> – The flux of the target star. [default: 1]</p></li>
<li><p><strong>**kwargs</strong> – Additional properties can also be given as keyword arguments if that
is more convenient than populating the properties dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Star instance</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.offset_to_center">
<code class="sig-name descname">offset_to_center</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">offset</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.offset_to_center"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.offset_to_center" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility routine to convert from an offset in image coordinates to the corresponding
center position in focal plane coordinates on the postage stamp image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>offset</strong> – A tuple (dx,dy) in image coordinates</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The corresponding (du,dv) in focal plane coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.read">
<em class="property">classmethod </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read stars from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a list of Star instances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.read_coords_params">
<em class="property">classmethod </em><code class="sig-name descname">read_coords_params</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.read_coords_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.read_coords_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only star fit parameters and coordinates from a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to read from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the arrays coords and params</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.withFlux">
<code class="sig-name descname">withFlux</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">flux</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">center</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.withFlux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.withFlux" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the flux and/or center values</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flux</strong> – The new flux.  [default: None, which means keep the existing value.]</p></li>
<li><p><strong>center</strong> – The new center.  [default: None, which means keep the existing value.]</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.Star.write">
<em class="property">classmethod </em><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stars</span></em>, <em class="sig-param"><span class="n">fits</span></em>, <em class="sig-param"><span class="n">extname</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#Star.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.Star.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a list of stars to a FITS file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stars</strong> – A list of stars to write</p></li>
<li><p><strong>fits</strong> – An open fitsio.FITS object</p></li>
<li><p><strong>extname</strong> – The name of the extension to write to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="piff.StarData">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">StarData</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">image_pos</span></em>, <em class="sig-param"><span class="n">weight</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">pointing</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">field_pos</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">properties</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">orig_weight</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">logger</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">_xyuv_set</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData" title="Permalink to this definition">¶</a></dt>
<dd><p>A class that encapsulates all the relevant information about an observed star.</p>
<p><strong>Class intended to be immutable once returned from the method that creates it.</strong></p>
<dl class="simple">
<dt>This includes:</dt><dd><ul class="simple">
<li><p>a postage stamp of the imaging data</p></li>
<li><p>the weight map for these pixels (zero weight means the pixel is masked or otherwise bad)</p></li>
<li><p>whether the pixel values represent flux or surface brightness</p></li>
<li><p>the pixel area on the sky</p></li>
<li><p>the position of the star on the image</p></li>
<li><p>the position of the star in the full field-of-view (local tangent plane projection)</p></li>
<li><p>possibly extra information, such as colors</p></li>
</ul>
</dd>
</dl>
<p>A StarData object can render the pixel data in one of two ways:</p>
<blockquote>
<div><ul class="simple">
<li><p>getImage() returns the pixels as a galsim.Image.</p></li>
<li><p>getDataVector() returns the pixels as a numpy array.</p></li>
</ul>
</div></blockquote>
<p>Different use cases may prefer the data in one of these forms or the other.</p>
<dl class="simple">
<dt>A StarData object also has this property:</dt><dd><dl class="field-list simple">
<dt class="field-odd">property pixel_area</dt>
<dd class="field-odd"><p>Solid angle on sky subtended by each pixel,
in units of the uv system.</p>
</dd>
</dl>
</dd>
</dl>
<p>The other information is stored in a dict.  This dict will include at least the following
items:</p>
<blockquote>
<div><ul class="simple">
<li><p>x</p></li>
<li><p>y</p></li>
<li><p>u</p></li>
<li><p>v</p></li>
</ul>
</div></blockquote>
<p>And anything else you want to store.  e.g.</p>
<blockquote>
<div><ul class="simple">
<li><p>chipnum</p></li>
<li><p>ra</p></li>
<li><p>dec</p></li>
<li><p>color_ri</p></li>
<li><p>color_iz</p></li>
<li><p>gain</p></li>
</ul>
</div></blockquote>
<p>Any of these values may be used for interpolation.  The most typical choices would be either
(x,y) or (u,v).  The choice of what values to use is made by the interpolator.  All such
values should be either int or float values.</p>
<p>Note that the position given for the star does not have to be a proper centroid.  It is
rather just some position in image coordinates to use as the origin of the model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – A postage stamp image that includes the star</p></li>
<li><p><strong>image_pos</strong> – The position in image coordinates to use as the “center” of the star.
Note: this does not have to be the centroid or anything specific about the
star.  It is merely the image position of the (0,0) coordinate for the
model’s internal coordinate system.</p></li>
<li><p><strong>weight</strong> – The corresponding weight map for that image. [default: None]</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord representing the pointing coordinate of the
exposure.  It does not have to be the exact center of the field of view.
But it should be the same for all StarData objects in the exposure.
This is required if image.wcs is a CelestialWCS, but should be None
if image.wcs is a EuclideanWCS. [default: None]</p></li>
<li><p><strong>field_pos</strong> – Optionally provide the field_pos directly, rather than calculating it from
the wcs and a pointing. [default: None]</p></li>
<li><p><strong>properties</strong> – A dict containing other properties about the star that might be of
interest. [default: None]</p></li>
<li><p><strong>orig_weight</strong> – The original weight map prior to any additional Poisson variance being
added.  [default: None, which means use orig_weight=weight]</p></li>
<li><p><strong>logger</strong> – A logger object for logging debug info. [default: None]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="piff.StarData.addPoisson">
<code class="sig-name descname">addPoisson</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">signal</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">gain</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.addPoisson"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.addPoisson" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarData with the weight values altered to reflect
Poisson shot noise from a signal source, e.g. when the weight
only contains variance from background and read noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>signal</strong> – The signal (as a Star instance) from which the Poisson variance is
extracted.  If None, the data image is used.  All signals are
clipped from below at zero.</p></li>
<li><p><strong>gain</strong> – The gain, in e per ADU, assumed in calculating new weights.  If None
is given, then the ‘gain’ property is used, else defaults to not
adding any variance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new StarData instance with updated weight array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.calculateFieldPos">
<em class="property">static </em><code class="sig-name descname">calculateFieldPos</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image_pos</span></em>, <em class="sig-param"><span class="n">wcs</span></em>, <em class="sig-param"><span class="n">pointing</span></em>, <em class="sig-param"><span class="n">properties</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.calculateFieldPos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.calculateFieldPos" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert from image coordinates to field coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image_pos</strong> – The position in image coordinates, as a galsim.PositionD instance.</p></li>
<li><p><strong>wcs</strong> – The wcs to use to connect image coordinates with sky coordinates:</p></li>
<li><p><strong>pointing</strong> – A galsim.CelestialCoord representing the pointing coordinate of the
exposure.  This is required if image.wcs is a CelestialWCS, but should
be None if image.wcs is a EuclideanWCS. [default: None]</p></li>
<li><p><strong>properties</strong> – If properties is provided, and the wcs is a CelestialWCS, then add
‘ra’, ‘dec’ properties (in hours, degrees respectively) based on the
sky coordinates. [default: None]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a galsim.PositionD instance representing the position in field coordinates.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.getDataVector">
<code class="sig-name descname">getDataVector</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">include_zero_weight</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.getDataVector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.getDataVector" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pixel data as a numpy array.</p>
<p>Also returns the weight values and the local u,v coordinates of the pixels.
Any pixels with zero weight (e.g. from masking in the original image) will not be
included in the returned arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>include_zero_weight</strong> – Should points with zero weight be included? [default: False]</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>data_vector, weight_vector, u_vector, v_vector</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.getImage">
<code class="sig-name descname">getImage</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.getImage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.getImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the pixel data as a galsim.Image.</p>
<p>Also returns the weight image and the origin position (the position in x,y coordinates
to use as the origin of the PSF model).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>image, weight, image_pos</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.maskPixels">
<code class="sig-name descname">maskPixels</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.maskPixels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.maskPixels" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarData with weight nulled at pixels marked as False in the mask.
Note that this cannot un-mask any previously nulled pixels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mask</strong> – Boolean array with False marked in pixels that should henceforth
be ignored in fitting.
If this is a 2d array it is assumed to match the weight image.
If it is a 1d array, it is assumed to match the vectors returned by
getDataVector().  If None, the self.image is used, clipped from below</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A new StarData instance with updated weight array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="piff.StarData.setData">
<code class="sig-name descname">setData</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">include_zero_weight</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">copy_image</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarData.setData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarData.setData" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarData with data values replaced by elements of provided 1d array.
The array should match the ordering of the one that is produced by getDataVector().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – A 1d numpy array with new values for the image data.</p></li>
<li><p><strong>include_zero_weight</strong> – If True, the data array includes all pixels.
If False, it only includes the pixels with weight &gt; 0.
[default: False]</p></li>
<li><p><strong>copy_image</strong> – If False, will use the same image object.
If True, will copy the image and then overwrite it.
[default: True]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New StarData structure</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="piff.StarFit">
<em class="property">class </em><code class="sig-prename descclassname">piff.</code><code class="sig-name descname">StarFit</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="n">flux</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">center</span><span class="o">=</span><span class="default_value">0.0, 0.0</span></em>, <em class="sig-param"><span class="n">params_var</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">A</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">b</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">chisq</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dof</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarFit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarFit" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to hold the results of fitting a Model to some StarData, or specify
the PSF interpolated to an unmeasured location.</p>
<p><strong>Class is intended to be invariant once created.</strong></p>
<p>This class can be extended
to carry information of use to a given Model instance (such as intermediate
results), but interpolators will be looking for some subset of these properties:</p>
<dl class="field-list simple">
<dt class="field-odd">Params</dt>
<dd class="field-odd"><p>numpy vector of parameters of the PSF that apply to this star</p>
</dd>
<dt class="field-even">Params_var</dt>
<dd class="field-even"><p>numpy array of variance error parameters of the PSF</p>
</dd>
<dt class="field-odd">Flux</dt>
<dd class="field-odd"><p>flux of the star</p>
</dd>
<dt class="field-even">Center</dt>
<dd class="field-even"><p>(u,v) tuple giving position of stellar center (relative
to data.image_pos)</p>
</dd>
<dt class="field-odd">Chisq</dt>
<dd class="field-odd"><p>Chi-squared of  fit to the data (if any) with current params</p>
</dd>
<dt class="field-even">Dof</dt>
<dd class="field-even"><p>Degrees of freedom in the fit (will depend on whether last fit had
parameters free or just the flux/center).</p>
</dd>
<dt class="field-odd">A, b</dt>
<dd class="field-odd"><p>matrix, vector, giving design matrix equation for the Taylor expansion of chisq
wrt params about their current values. The alpha matrix, AT A, is also the
inverse covariance matrix of the params.</p>
</dd>
</dl>
<dl class="py method">
<dt id="piff.StarFit.newParams">
<code class="sig-name descname">newParams</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/piff/star.html#StarFit.newParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piff.StarFit.newParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Return new StarFit that has the array params installed as new parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – A 1d array holding new parameters; must match size of current ones</p></li>
<li><p><strong>kwargs</strong> – Any other additional properties for the star. Takes current flux and center if not provided, and otherwise puts in None</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>New StarFit object with altered parameters.  All chisq-related parameters
are set to None since they are no longer valid.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PSF</a><ul>
<li><a class="reference internal" href="#simplepsf">SimplePSF</a></li>
<li><a class="reference internal" href="#singlechippsf">SingleChipPSF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stars">Stars</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="output.html"
                        title="previous chapter">Writing the output file</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="stats.html"
                        title="next chapter">Stats</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/psf.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="stats.html" title="Stats"
             >next</a> |</li>
        <li class="right" >
          <a href="output.html" title="Writing the output file"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Piff 0.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.
    </div>
  </body>
</html>